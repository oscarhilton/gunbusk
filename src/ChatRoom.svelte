<script>
  import { gun } from './Gun/init-gun';
  import ChatFeedMessage from './ChatFeedMessage.svelte';
  import ChatBubble from './ChatBubble.svelte';
  import { user } from './Gun/init-gun'

  import { chatDialogue } from './User/chats';

  export let chatReady = false;
  export let chatsList;
  export let messageList;
  export let sendMessage;

  console.log("CHAT READY?", chatReady);
  
  let latestMessage;
  let publicKey;
  let roomId;
  let message = `HELLO WORLD !!! ${new Date()}`;

  let messages = {}

  chatsList.subscribe(({ latestMessage: l, pub: p, roomId: i }) => {
    latestMessage = l;
    publicKey = p;
    roomId = i;
    messageList(i, p).subscribe(message => {
      console.log(message, "MESSAGE");
      if (!message) return;

      const { content, id, sender, timeSent, type } = message.individual;
      const obj = { [timeSent]: { id, content, id, sender, timeSent, type } };
      Object.assign(messages, obj);
      messages = { ...messages, obj };
    });
    chatReady = true;
  });


  chatDialogue(roomId, foo => console.log(foo));

  const sendNewMessage = (e) => {
    e.preventDefault();
    console.log(message, publicKey, roomId)
    if (!roomId || !publicKey || !message) return;
    sendMessage(roomId, publicKey, message, res => console.log(res, "message result"));
  }
</script>

<div class='container'>
  <div class='chat-window chat-window--{chatReady ? 'ready' : 'waiting'}'>
    {#if chatReady}
      chat time!
    {:else}
    <div class="image">
      <svg width="700pt" height="700pt" version="1.1" viewBox="0 0 700 700" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <defs>
        <symbol id="v" overflow="visible">
        <path d="m18.766-1.125c-0.96875 0.5-1.9805 0.875-3.0312 1.125-1.043 0.25781-2.1367 0.39062-3.2812 0.39062-3.3984 0-6.0898-0.94531-8.0781-2.8438-1.9922-1.9062-2.9844-4.4844-2.9844-7.7344 0-3.2578 0.99219-5.8359 2.9844-7.7344 1.9883-1.9062 4.6797-2.8594 8.0781-2.8594 1.1445 0 2.2383 0.13281 3.2812 0.39062 1.0508 0.25 2.0625 0.625 3.0312 1.125v4.2188c-0.98047-0.65625-1.9453-1.1406-2.8906-1.4531-0.94922-0.3125-1.9492-0.46875-3-0.46875-1.875 0-3.3516 0.60547-4.4219 1.8125-1.0742 1.1992-1.6094 2.8555-1.6094 4.9688 0 2.1055 0.53516 3.7617 1.6094 4.9688 1.0703 1.1992 2.5469 1.7969 4.4219 1.7969 1.0508 0 2.0508-0.14844 3-0.45312 0.94531-0.3125 1.9102-0.80078 2.8906-1.4688z"/>
        </symbol>
        <symbol id="b" overflow="visible">
        <path d="m13.734-11.141c-0.4375-0.19531-0.87109-0.34375-1.2969-0.4375-0.41797-0.10156-0.83984-0.15625-1.2656-0.15625-1.2617 0-2.2305 0.40625-2.9062 1.2188-0.67969 0.80469-1.0156 1.9531-1.0156 3.4531v7.0625h-4.8906v-15.312h4.8906v2.5156c0.625-1 1.3438-1.7266 2.1562-2.1875 0.82031-0.46875 1.8008-0.70312 2.9375-0.70312 0.16406 0 0.34375 0.011719 0.53125 0.03125 0.19531 0.011719 0.47656 0.039062 0.84375 0.078125z"/>
        </symbol>
        <symbol id="a" overflow="visible">
        <path d="m17.641-7.7031v1.4062h-11.453c0.125 1.1484 0.53906 2.0078 1.25 2.5781 0.70703 0.57422 1.7031 0.85938 2.9844 0.85938 1.0312 0 2.082-0.14844 3.1562-0.45312 1.082-0.3125 2.1914-0.77344 3.3281-1.3906v3.7656c-1.1562 0.4375-2.3125 0.76562-3.4688 0.98438-1.1562 0.22656-2.3125 0.34375-3.4688 0.34375-2.7734 0-4.9297-0.70312-6.4688-2.1094-1.5312-1.4062-2.2969-3.3789-2.2969-5.9219 0-2.5 0.75391-4.4609 2.2656-5.8906 1.5078-1.4375 3.582-2.1562 6.2188-2.1562 2.4062 0 4.332 0.73047 5.7812 2.1875 1.4453 1.4492 2.1719 3.3828 2.1719 5.7969zm-5.0312-1.625c0-0.92578-0.27344-1.6719-0.8125-2.2344-0.54297-0.57031-1.25-0.85938-2.125-0.85938-0.94922 0-1.7188 0.26562-2.3125 0.79688s-0.96484 1.2969-1.1094 2.2969z"/>
        </symbol>
        <symbol id="f" overflow="visible">
        <path d="m9.2188-6.8906c-1.0234 0-1.793 0.17188-2.3125 0.51562-0.51172 0.34375-0.76562 0.85547-0.76562 1.5312 0 0.625 0.20703 1.1172 0.625 1.4688 0.41406 0.34375 0.98828 0.51562 1.7188 0.51562 0.92578 0 1.7031-0.32812 2.3281-0.98438 0.63281-0.66406 0.95312-1.4922 0.95312-2.4844v-0.5625zm7.4688-1.8438v8.7344h-4.9219v-2.2656c-0.65625 0.92969-1.3984 1.6055-2.2188 2.0312-0.82422 0.41406-1.8242 0.625-3 0.625-1.5859 0-2.8711-0.45703-3.8594-1.375-0.99219-0.92578-1.4844-2.1289-1.4844-3.6094 0-1.7891 0.61328-3.1016 1.8438-3.9375 1.2383-0.84375 3.1797-1.2656 5.8281-1.2656h2.8906v-0.39062c0-0.76953-0.30859-1.332-0.92188-1.6875-0.61719-0.36328-1.5703-0.54688-2.8594-0.54688-1.0547 0-2.0312 0.10547-2.9375 0.3125-0.89844 0.21094-1.7305 0.52344-2.5 0.9375v-3.7344c1.0391-0.25 2.0859-0.44141 3.1406-0.57812 1.0625-0.13281 2.125-0.20312 3.1875-0.20312 2.7578 0 4.75 0.54688 5.9688 1.6406 1.2266 1.0859 1.8438 2.8555 1.8438 5.3125z"/>
        </symbol>
        <symbol id="e" overflow="visible">
        <path d="m7.7031-19.656v4.3438h5.0469v3.5h-5.0469v6.5c0 0.71094 0.14062 1.1875 0.42188 1.4375s0.83594 0.375 1.6719 0.375h2.5156v3.5h-4.1875c-1.9375 0-3.3125-0.39844-4.125-1.2031-0.80469-0.8125-1.2031-2.1797-1.2031-4.1094v-6.5h-2.4219v-3.5h2.4219v-4.3438z"/>
        </symbol>
        <symbol id="j" overflow="visible">
        <path d="m12.766-13.078v-8.2031h4.9219v21.281h-4.9219v-2.2188c-0.66797 0.90625-1.4062 1.5703-2.2188 1.9844s-1.7578 0.625-2.8281 0.625c-1.8867 0-3.4336-0.75-4.6406-2.25-1.2109-1.5-1.8125-3.4258-1.8125-5.7812 0-2.3633 0.60156-4.2969 1.8125-5.7969 1.207-1.5 2.7539-2.25 4.6406-2.25 1.0625 0 2 0.21484 2.8125 0.64062 0.82031 0.42969 1.5664 1.0859 2.2344 1.9688zm-3.2188 9.9219c1.0391 0 1.8359-0.37891 2.3906-1.1406 0.55078-0.76953 0.82812-1.8828 0.82812-3.3438 0-1.457-0.27734-2.5664-0.82812-3.3281-0.55469-0.76953-1.3516-1.1562-2.3906-1.1562-1.043 0-1.8398 0.38672-2.3906 1.1562-0.55469 0.76172-0.82812 1.8711-0.82812 3.3281 0 1.4609 0.27344 2.5742 0.82812 3.3438 0.55078 0.76172 1.3477 1.1406 2.3906 1.1406z"/>
        </symbol>
        <symbol id="i" overflow="visible">
        <path d="m10.5-3.1562c1.0508 0 1.8516-0.37891 2.4062-1.1406 0.55078-0.76953 0.82812-1.8828 0.82812-3.3438 0-1.457-0.27734-2.5664-0.82812-3.3281-0.55469-0.76953-1.3555-1.1562-2.4062-1.1562-1.0547 0-1.8594 0.38672-2.4219 1.1562-0.55469 0.77344-0.82812 1.8828-0.82812 3.3281 0 1.4492 0.27344 2.5586 0.82812 3.3281 0.5625 0.77344 1.3672 1.1562 2.4219 1.1562zm-3.25-9.9219c0.67578-0.88281 1.4219-1.5391 2.2344-1.9688 0.82031-0.42578 1.7656-0.64062 2.8281-0.64062 1.8945 0 3.4453 0.75 4.6562 2.25 1.207 1.5 1.8125 3.4336 1.8125 5.7969 0 2.3555-0.60547 4.2812-1.8125 5.7812-1.2109 1.5-2.7617 2.25-4.6562 2.25-1.0625 0-2.0078-0.21094-2.8281-0.625-0.8125-0.42578-1.5586-1.0859-2.2344-1.9844v2.2188h-4.8906v-21.281h4.8906z"/>
        </symbol>
        <symbol id="d" overflow="visible">
        <path d="m0.34375-15.312h4.8906l4.125 10.391 3.5-10.391h4.8906l-6.4375 16.766c-0.64844 1.6953-1.4023 2.8828-2.2656 3.5625-0.86719 0.6875-2 1.0312-3.4062 1.0312h-2.8438v-3.2188h1.5312c0.83203 0 1.4375-0.13672 1.8125-0.40625 0.38281-0.26172 0.67969-0.73047 0.89062-1.4062l0.14062-0.42188z"/>
        </symbol>
        <symbol id="h" overflow="visible">
        <path d="m14.953-3.7188h-8.2188l-1.3125 3.7188h-5.2812l7.5625-20.406h6.2656l7.5625 20.406h-5.2812zm-6.9062-3.7812h5.5781l-2.7812-8.125z"/>
        </symbol>
        <symbol id="g" overflow="visible">
        <path d="m17.75-9.3281v9.3281h-4.9219v-7.1406c0-1.3203-0.03125-2.2344-0.09375-2.7344s-0.16797-0.86719-0.3125-1.1094c-0.1875-0.3125-0.44922-0.55469-0.78125-0.73438-0.32422-0.17578-0.69531-0.26562-1.1094-0.26562-1.0234 0-1.8242 0.39844-2.4062 1.1875-0.58594 0.78125-0.875 1.8711-0.875 3.2656v7.5312h-4.8906v-15.312h4.8906v2.2344c0.73828-0.88281 1.5195-1.5391 2.3438-1.9688 0.83203-0.42578 1.75-0.64062 2.75-0.64062 1.7695 0 3.1133 0.54688 4.0312 1.6406 0.91406 1.0859 1.375 2.6562 1.375 4.7188z"/>
        </symbol>
        <symbol id="u" overflow="visible">
        <path d="m7.8281-16.438v12.453h1.8906c2.1562 0 3.8008-0.53125 4.9375-1.5938 1.1328-1.0625 1.7031-2.6133 1.7031-4.6562 0-2.0195-0.57031-3.5547-1.7031-4.6094-1.125-1.0625-2.7734-1.5938-4.9375-1.5938zm-5.25-3.9688h5.5469c3.0938 0 5.3984 0.21875 6.9219 0.65625 1.5195 0.4375 2.8203 1.1875 3.9062 2.25 0.95703 0.91797 1.6641 1.9805 2.125 3.1875 0.46875 1.1992 0.70312 2.5586 0.70312 4.0781 0 1.543-0.23438 2.918-0.70312 4.125-0.46094 1.2109-1.168 2.2773-2.125 3.2031-1.0938 1.0547-2.4062 1.8047-3.9375 2.25-1.5312 0.4375-3.8281 0.65625-6.8906 0.65625h-5.5469z"/>
        </symbol>
        <symbol id="t" overflow="visible">
        <path d="m0.42188-15.312h4.8906l3.8281 10.578 3.7969-10.578h4.9062l-6.0312 15.312h-5.375z"/>
        </symbol>
        <symbol id="s" overflow="visible">
        <path d="m2.3594-21.281h4.8906v11.594l5.625-5.625h5.6875l-7.4688 7.0312 8.0625 8.2812h-5.9375l-5.9688-6.3906v6.3906h-4.8906z"/>
        </symbol>
        <symbol id="c" overflow="visible">
        <path d="m9.6406-12.188c-1.0859 0-1.9141 0.39062-2.4844 1.1719-0.57422 0.78125-0.85938 1.9062-0.85938 3.375s0.28516 2.5938 0.85938 3.375c0.57031 0.77344 1.3984 1.1562 2.4844 1.1562 1.0625 0 1.875-0.38281 2.4375-1.1562 0.57031-0.78125 0.85938-1.9062 0.85938-3.375s-0.28906-2.5938-0.85938-3.375c-0.5625-0.78125-1.375-1.1719-2.4375-1.1719zm0-3.5c2.6328 0 4.6914 0.71484 6.1719 2.1406 1.4766 1.418 2.2188 3.3867 2.2188 5.9062 0 2.5117-0.74219 4.4805-2.2188 5.9062-1.4805 1.418-3.5391 2.125-6.1719 2.125-2.6484 0-4.7148-0.70703-6.2031-2.125-1.4922-1.4258-2.2344-3.3945-2.2344-5.9062 0-2.5195 0.74219-4.4883 2.2344-5.9062 1.4883-1.4258 3.5547-2.1406 6.2031-2.1406z"/>
        </symbol>
        <symbol id="r" overflow="visible">
        <path d="m12.422-21.281v3.2188h-2.7031c-0.6875 0-1.1719 0.125-1.4531 0.375-0.27344 0.25-0.40625 0.6875-0.40625 1.3125v1.0625h4.1875v3.5h-4.1875v11.812h-4.8906v-11.812h-2.4375v-3.5h2.4375v-1.0625c0-1.6641 0.46094-2.8984 1.3906-3.7031 0.92578-0.80078 2.3672-1.2031 4.3281-1.2031z"/>
        </symbol>
        <symbol id="q" overflow="visible">
        <path d="m16.547-12.766c0.61328-0.94531 1.3477-1.6719 2.2031-2.1719 0.85156-0.5 1.7891-0.75 2.8125-0.75 1.7578 0 3.0977 0.54688 4.0156 1.6406 0.92578 1.0859 1.3906 2.6562 1.3906 4.7188v9.3281h-4.9219v-7.9844-0.35938c0.007813-0.13281 0.015625-0.32031 0.015625-0.5625 0-1.082-0.16406-1.8633-0.48438-2.3438-0.3125-0.48828-0.82422-0.73438-1.5312-0.73438-0.92969 0-1.6484 0.38672-2.1562 1.1562-0.51172 0.76172-0.77344 1.8672-0.78125 3.3125v7.5156h-4.9219v-7.9844c0-1.6953-0.14844-2.7852-0.4375-3.2656-0.29297-0.48828-0.8125-0.73438-1.5625-0.73438-0.9375 0-1.6641 0.38672-2.1719 1.1562-0.51172 0.76172-0.76562 1.8594-0.76562 3.2969v7.5312h-4.9219v-15.312h4.9219v2.2344c0.60156-0.86328 1.2891-1.5156 2.0625-1.9531 0.78125-0.4375 1.6406-0.65625 2.5781-0.65625 1.0625 0 2 0.25781 2.8125 0.76562 0.8125 0.51172 1.4258 1.2305 1.8438 2.1562z"/>
        </symbol>
        <symbol id="p" overflow="visible">
        <path d="m17.75-9.3281v9.3281h-4.9219v-7.1094c0-1.3438-0.03125-2.2656-0.09375-2.7656s-0.16797-0.86719-0.3125-1.1094c-0.1875-0.3125-0.44922-0.55469-0.78125-0.73438-0.32422-0.17578-0.69531-0.26562-1.1094-0.26562-1.0234 0-1.8242 0.39844-2.4062 1.1875-0.58594 0.78125-0.875 1.8711-0.875 3.2656v7.5312h-4.8906v-21.281h4.8906v8.2031c0.73828-0.88281 1.5195-1.5391 2.3438-1.9688 0.83203-0.42578 1.75-0.64062 2.75-0.64062 1.7695 0 3.1133 0.54688 4.0312 1.6406 0.91406 1.0859 1.375 2.6562 1.375 4.7188z"/>
        </symbol>
        <symbol id="o" overflow="visible">
        <path d="m2.5781-20.406h5.875l7.4219 14v-14h4.9844v20.406h-5.875l-7.4219-14v14h-4.9844z"/>
        </symbol>
        <symbol id="n" overflow="visible">
        <path d="m2.1875-5.9688v-9.3438h4.9219v1.5312c0 0.83594-0.007813 1.875-0.015625 3.125-0.011719 1.25-0.015625 2.0859-0.015625 2.5 0 1.2422 0.03125 2.1328 0.09375 2.6719 0.070313 0.54297 0.17969 0.93359 0.32812 1.1719 0.20703 0.32422 0.47266 0.57422 0.79688 0.75 0.32031 0.16797 0.69141 0.25 1.1094 0.25 1.0195 0 1.8203-0.39062 2.4062-1.1719 0.58203-0.78125 0.875-1.8672 0.875-3.2656v-7.5625h4.8906v15.312h-4.8906v-2.2188c-0.74219 0.89844-1.5234 1.5586-2.3438 1.9844-0.82422 0.41406-1.7344 0.625-2.7344 0.625-1.7617 0-3.1055-0.53906-4.0312-1.625-0.92969-1.082-1.3906-2.6602-1.3906-4.7344z"/>
        </symbol>
        <symbol id="m" overflow="visible">
        <path d="m2.5781-20.406h8.7344c2.5938 0 4.582 0.57812 5.9688 1.7344 1.3945 1.1484 2.0938 2.7891 2.0938 4.9219 0 2.1367-0.69922 3.7812-2.0938 4.9375-1.3867 1.1562-3.375 1.7344-5.9688 1.7344h-3.4844v7.0781h-5.25zm5.25 3.8125v5.7031h2.9219c1.0195 0 1.8047-0.25 2.3594-0.75 0.5625-0.5 0.84375-1.2031 0.84375-2.1094 0-0.91406-0.28125-1.6172-0.84375-2.1094-0.55469-0.48828-1.3398-0.73438-2.3594-0.73438z"/>
        </symbol>
        <symbol id="l" overflow="visible">
        <path d="m2.3594-15.312h4.8906v15.031c0 2.0508-0.49609 3.6172-1.4844 4.7031-0.98047 1.082-2.4062 1.625-4.2812 1.625h-2.4219v-3.2188h0.85938c0.92578 0 1.5625-0.21094 1.9062-0.625 0.35156-0.41797 0.53125-1.2461 0.53125-2.4844zm0-5.9688h4.8906v4h-4.8906z"/>
        </symbol>
        <symbol id="k" overflow="visible">
        <path d="m14.719-14.828v3.9844c-0.65625-0.45703-1.3242-0.79688-2-1.0156-0.66797-0.21875-1.3594-0.32812-2.0781-0.32812-1.3672 0-2.4336 0.40234-3.2031 1.2031-0.76172 0.79297-1.1406 1.9062-1.1406 3.3438 0 1.4297 0.37891 2.543 1.1406 3.3438 0.76953 0.79297 1.8359 1.1875 3.2031 1.1875 0.75781 0 1.4844-0.10938 2.1719-0.32812 0.6875-0.22656 1.3203-0.56641 1.9062-1.0156v4c-0.76172 0.28125-1.5391 0.48828-2.3281 0.625-0.78125 0.14453-1.5742 0.21875-2.375 0.21875-2.7617 0-4.9219-0.70703-6.4844-2.125-1.5547-1.4141-2.3281-3.3828-2.3281-5.9062 0-2.5312 0.77344-4.5039 2.3281-5.9219 1.5625-1.4141 3.7227-2.125 6.4844-2.125 0.80078 0 1.5938 0.074219 2.375 0.21875 0.78125 0.13672 1.5547 0.35156 2.3281 0.64062z"/>
        </symbol>
      </defs>
      <g>
        <path d="m531.16 285.6c-0.47656-1.7852-1.0938-3.5273-1.8477-5.2109l-0.44922-1.1211v-0.61719c0-0.22266-0.44922-0.95312-0.72656-1.3984l-0.55859-1.3984-3.9766-9.2383-2.7422-6.7773v-0.55859l-0.67188-1.2305-3.9766-9.7422-3.8125-9.2461c-1.6406-3.7812-4.4727-6.9258-8.0625-8.957-3.5781-1.9961-7.6836-2.8359-11.762-2.4102-1.9258 0.24219-3.8125 0.75-5.5977 1.5117 0.007813-1.4102-0.125-2.8164-0.39062-4.1992-1.0625-5.4727-4.1641-10.34-8.6836-13.609l-4.0312-2.5195s-0.33594-0.39062-0.55859-0.50391l-1.6797-0.89453-15.234-9.8555-0.39063-0.33594-1.1758-0.61719-11.984-7.3906c-2.0156-1.2305-3.6953-2.4062-5.9922-3.6953-2.4648-1.4219-5.2227-2.2656-8.0625-2.4648-5.7578-0.35547-11.379 1.8594-15.344 6.0469-1.9531 2.0742-3.4062 4.5625-4.2578 7.2812-0.69531 2.5039-1.1094 5.0742-1.2305 7.6719-0.44922 10.191 2.1836 18.93 1.2891 27.441l-0.003906-0.003906c-0.93359 8.6133-3.9727 16.863-8.8477 24.027l-28.617 45.754-31.695-57.68 26.715-42.898 14-22.398v-0.003906c3.0039-4.2578 4.4648-9.4141 4.1445-14.617-0.41016-5.3008-2.6953-10.281-6.4414-14.055-1.7656-1.543-3.6797-2.9141-5.7109-4.0859l-0.78516-0.44922s0-0.33594-0.44922-0.39062l-1.3438-0.78516-3.0234-1.8477-11.199-7-1.6797-1.0625-0.44922-0.39062-1.457-0.78516-7.5586-4.7617-5.6016-3.4727c-1.9688-1.332-4.0273-2.5273-6.1562-3.5859-5.0508-2.1758-10.789-2.0781-15.762 0.26563-4.9727 2.3477-8.6953 6.7188-10.223 12-2.6328 9.9102 0 19.207 0 27.441 0.27344 4.5469-0.10547 9.1094-1.1211 13.551-1.957-3.9961-5.0312-7.3438-8.8477-9.6328l-2.4062-1.5117-0.33594-0.28125-0.39453-0.50391-21.391-13.383-12.488-7.8398c-2.4531-1.6445-5.2148-2.7695-8.1211-3.3047-4.5547-0.71094-9.2188 0.23047-13.141 2.6523-3.9219 2.4258-6.8516 6.1719-8.25 10.566-1.3516 5.2422-1.6953 10.699-1.0078 16.07 1.8633 9.2656 1.6523 18.828-0.61719 28-1.3281 4.4375-3.2109 8.6875-5.6016 12.656-1.3789 2.2109-2.6133 4.5117-3.6953 6.8867-1.1367 2.5-1.9453 5.1328-2.4062 7.8398-1.9805 11.027 1.3633 22.34 9.0156 30.52 1.832 2.1406 3.9414 4.0234 6.2695 5.6016 2.1836 1.5117 4.1992 2.6875 6.3281 4.0312l11.199 7.1133-2.6875 4.3125-6.9453 11.199h0.003906c-2.1914 3.2734-6.418 4.5-10.023 2.9102l-1.0078-0.50391-1.3438-0.83984-5.6016-3.4727-11.199-7.0547-20.832-13.719c-0.27734-0.25391-0.57812-0.48047-0.89844-0.67188-5.582-3.3086-12.711-2.3281-17.195 2.3672-4.4805 4.6953-5.1289 11.863-1.5625 17.289v0.28125l46.648 63.895c1.9727 2.9258 4.1445 5.7109 6.4961 8.3438 0.6875 0.64453 1.418 1.2422 2.1836 1.793-4.0859 4.4336-7.8281 9.168-11.199 14.168-1.9688 2.9219-3.707 5.9922-5.2109 9.1836-1.6953 3.3672-2.793 7.0078-3.2461 10.75-0.45312 6.3828 2.0273 12.621 6.7344 16.949 4.7109 4.3281 11.137 6.2773 17.457 5.2852 6.3203-0.98828 11.844-4.8008 15.008-10.363 2.207-4.168 3.0117-8.9414 2.2969-13.605-0.63672-4.1875-1.7656-8.2852-3.3594-12.207-2.3281-5.6719-5.0781-11.156-8.2344-16.41h147.23c2.0117 0.10938 4.0312 0.10938 6.0469 0 0.39062 0.054688 0.78516 0.054688 1.1758 0 52.305 0 99.062 33.602 108.81 78.398v0.003906c0.37109 1.7383 1.9141 2.9805 3.6953 2.9648h0.78516c0.98438-0.19922 1.8438-0.78906 2.3906-1.6289 0.54688-0.84375 0.73438-1.8672 0.51953-2.8516-9.2383-42.223-49.168-75.32-96.711-82.543l3.1914-1.2891 36.793-14.559 36.848-14.559 18.367-7.3359 9.2383-3.5859h0.003906c3.5312-1.1562 6.8164-2.9609 9.6875-5.3203 3-2.6719 5.2148-6.1133 6.3984-9.9531 1.1836-3.8398 1.2969-7.9297 0.32031-11.828zm-124.38-26.098c5.3828-8.2188 8.7266-17.609 9.7422-27.383 0.83984-9.9102-1.8477-19.32-1.3438-27.551v-0.003906c0.097656-2.0078 0.41797-3.9961 0.95312-5.9336 0.55469-1.6641 1.4492-3.1875 2.6328-4.4805 2.4922-2.6211 6.0195-3.9961 9.6289-3.7539 1.7617 0.13672 3.4648 0.67187 4.9844 1.5703 1.625 0.89453 3.6406 2.2383 5.6016 3.3594-1.7617 0.72266-3.3789 1.7695-4.7617 3.0781-2.7656 2.75-4.6055 6.293-5.2617 10.137-0.64063 3.3789-0.86328 6.8203-0.67188 10.25 0.14844 2.0273 1.8867 3.5664 3.918 3.4727 0.98047-0.058594 1.8984-0.50391 2.5508-1.2422 0.65234-0.73438 0.98438-1.6992 0.92188-2.6797-0.19922-2.8281-0.03125-5.6719 0.50391-8.457 0.32031-2.3828 1.4023-4.6016 3.082-6.3281 3.7773-2.9727 9.0977-2.9727 12.879 0h0.33594l4.0898 2.5742-0.003906 0.003907c-1.75 0.72266-3.3594 1.7461-4.7578 3.0234-2.7578 2.7773-4.5977 6.3359-5.2656 10.191-0.66406 3.375-0.89062 6.8164-0.67188 10.25 0.37109 1.6992 1.875 2.9102 3.6133 2.9102s3.2422-1.2109 3.6133-2.9102c-0.19141-2.8281-0.042968-5.668 0.44531-8.457 0.35938-2.3867 1.457-4.5977 3.1367-6.3281 3.7773-2.9727 9.1016-2.9727 12.879 0l4.0312 2.5195h0.003906c2.9805 2.1914 5.0234 5.4258 5.7305 9.0547 0.70703 3.6328 0.019531 7.3984-1.9258 10.547-0.023438 0.20312-0.023438 0.41016 0 0.61328-2.8125 3.875-5.3555 7.9336-7.6133 12.152-2.8438 5.5117-6.6328 10.477-11.199 14.672-4.7188 4.0312-10.078 7.2461-15.852 9.5195l-59.133 23.184zm-164.19-3.6953c-2.0703-1.3438-4.3125-2.6328-6.1602-3.9219-1.8242-1.1953-3.4961-2.6055-4.9844-4.1992-6.0977-6.4453-8.7773-15.398-7.2266-24.137 0.37891-2.1406 1.0195-4.2266 1.9062-6.2148 0.94141-2.1172 2.0469-4.1562 3.3047-6.1055 2.6758-4.5 4.7812-9.3164 6.2695-14.336 1.543-5.0625 2.3164-10.328 2.2969-15.621 0-5.2656-0.83984-10.246-1.2891-15.008-0.58984-4.4336-0.33984-8.9336 0.73047-13.273 1.2188-3.4961 3.9883-6.2266 7.5039-7.3906 3.8086-1.2852 8.0039-0.59375 11.199 1.8477l3.3594 2.1289v-0.003906c-1.8086 0.73047-3.4609 1.793-4.8711 3.1367-2.7461 2.6094-4.6406 5.9844-5.4336 9.6875-0.63672 3.3789-0.86328 6.8203-0.67188 10.25 0.14844 2.0273 1.8906 3.5664 3.9219 3.4727 0.98047-0.058594 1.8984-0.50391 2.5469-1.2383 0.65234-0.73828 0.98438-1.7031 0.92578-2.6836-0.20312-2.8281-0.03125-5.6719 0.50391-8.457 0.31641-2.3828 1.3984-4.6016 3.0781-6.3281 3.7773-2.9688 9.1016-2.9688 12.879 0 0.28125 0.035157 0.5625 0.035157 0.83984 0l4.2578 2.6875v0.003907c-1.7617 0.72266-3.3789 1.7656-4.7617 3.0781-2.7656 2.75-4.6055 6.293-5.2617 10.137-0.64062 3.375-0.86328 6.8164-0.67188 10.246-0.050781 1.0508 0.35156 2.0703 1.0977 2.8047 0.74609 0.73438 1.7734 1.1211 2.8203 1.0547 1.0469-0.0625 2.0156-0.56641 2.668-1.3906 0.65234-0.82031 0.92578-1.8828 0.75-2.9141-0.20312-2.8125-0.035156-5.6367 0.50391-8.4023 0.34766-2.375 1.4258-4.5859 3.0781-6.3281 3.7656-3.0117 9.1172-3.0117 12.883 0h0.33594l2.3516 1.5117c3.4805 1.9766 6.0078 5.2812 7 9.1602 0.99219 3.875 0.36719 7.9883-1.7383 11.395-2.9688 4.9844-6.2734 10.023-9.3516 15.008l-28 44.801-7.2227 12.934zm277.03 45.863c-2.2539 1.8125-4.8438 3.1641-7.6172 3.9766l-9.1836 3.6406-18.426 7.2773-73.586 29.117-9.1289 3.6406 0.003906 0.003906c-5.7734 2.2344-11.898 3.4102-18.086 3.4727h-145.6c-0.65234 0.085938-1.3086 0.085938-1.9609 0-2.5547-0.43359-4.9297-1.6016-6.832-3.3594-1.625-1.5664-3.5273-4.7031-5.6016-7.2812l-39.199-53.93c4.1094-0.48828 7.7773-2.8164 9.9688-6.3281 1.1836-1.8672 1.8789-4.0039 2.0156-6.2148l22.398 14 5.6016 3.4727 1.457 0.89453c0.61719 0.37109 1.2539 0.70703 1.9062 1.0078 3.3438 1.4258 7.082 1.6445 10.574 0.625s6.5234-3.2188 8.5742-6.2227l7.0547-11.199 14-22.398 28-44.801c3.0234-5.0391 6.1602-9.7422 9.1836-14.84l0.003906-0.003906c0.089844 0.019532 0.1875 0.019532 0.28125 0 0.1875-0.32422 0.35547-0.66016 0.50391-1.0078 1.2891-2.1836 2.5195-4.4258 3.6953-6.832 4.2461-8.4531 6.1758-17.883 5.5977-27.328-0.61719-9.1836-2.5742-17.641-0.50391-24.977 0.94531-3.2656 3.2461-5.9688 6.3203-7.4258 3.0742-1.457 6.625-1.5273 9.7539-0.1875 1.3438 0.61719 3.3594 1.9609 5.207 3.0781l1.3984 0.89453v0.003906c-1.7773 0.72266-3.4102 1.7656-4.8125 3.0781-2.7656 2.75-4.6055 6.293-5.2656 10.137-0.63672 3.375-0.86328 6.8164-0.67187 10.246 0.14844 2.0312 1.8867 3.5703 3.918 3.4727 0.98438-0.054688 1.8984-0.50391 2.5508-1.2383 0.65234-0.73438 0.98437-1.6992 0.92187-2.6797-0.19922-2.8281-0.03125-5.6719 0.50391-8.457 0.050781-2.5391 0.91406-4.9922 2.4648-7 3.8008-3.0312 9.1914-3.0312 12.992 0h0.50391l1.625 1.0078 2.3516 1.457c-1.7656 0.75-3.3945 1.793-4.8164 3.0781-2.7656 2.7734-4.6055 6.332-5.2656 10.191-0.63672 3.3984-0.86328 6.8555-0.67188 10.305 0.058594 0.98047 0.50391 1.8984 1.2422 2.5508 0.73438 0.65234 1.6992 0.98438 2.6797 0.92188 0.98437-0.042969 1.9141-0.48438 2.5664-1.2227 0.65625-0.73828 0.98047-1.7109 0.90625-2.6953-0.20312-2.8125-0.03125-5.6367 0.50391-8.4023 0.32031-2.3867 1.3984-4.6055 3.0781-6.3281 3.7812-2.9727 9.1016-2.9727 12.883 0h0.50391c1.9922 1.0742 3.8672 2.3477 5.5977 3.8086 2.582 2.5898 4.1172 6.0391 4.3125 9.6875 0.21875 3.6562-0.875 7.2695-3.0781 10.191l-14 22.398-28 44.801v0.003906c-0.65234 1.1445-0.65234 2.5469 0 3.6953l33.879 61.992c0.44531 1.0625 1.3516 1.8672 2.4648 2.1836 0.46094 0.085938 0.9375 0.085938 1.3984 0h0.95313l73.863-28.785c6.5078-2.5977 12.543-6.2461 17.863-10.809 5.2148-4.8008 9.5352-10.488 12.77-16.801 2.6836-5.6133 6.2383-10.773 10.527-15.285 3.8008-3.5977 9.5117-4.2812 14.055-1.6797 2.2344 1.2461 3.9727 3.2227 4.9297 5.5977l2.4062 5.6016c-1.832-0.44922-3.7305-0.54297-5.5977-0.28125-3.8594 0.58594-7.4336 2.3906-10.195 5.1523-2.5156 2.3555-4.7188 5.0312-6.5508 7.9531-0.54297 0.82813-0.73047 1.8398-0.51953 2.8086 0.21094 0.96875 0.80078 1.8125 1.6406 2.3438 1.7539 1.0547 4.0312 0.53516 5.1523-1.1758 1.4414-2.418 3.2148-4.625 5.2617-6.5547 1.6758-1.7344 3.8477-2.9102 6.2188-3.3594 4.7891-0.21094 9.0977 2.8945 10.414 7.5039-0.023438 0.12891-0.023438 0.26172 0 0.39062l1.793 4.4258c-1.8516-0.35547-3.75-0.35547-5.6016 0-3.8555 0.59766-7.4219 2.4023-10.191 5.1523-2.4336 2.4414-4.543 5.1914-6.2695 8.1758-1.1016 1.7305-0.58594 4.0273 1.1445 5.125 1.7344 1.0977 4.0273 0.58203 5.125-1.1484 1.4609-2.4062 3.2305-4.6094 5.2656-6.5508 1.6523-1.7617 3.8359-2.9414 6.2148-3.3633 4.7969-0.19531 9.1133 2.8984 10.473 7.5039l0.33594 0.44922 0.44922 1.1211c0.62891 1.3242 1.1172 2.7148 1.4531 4.1445 0.64062 2.5742 0.5625 5.2734-0.21484 7.8086-0.78125 2.5352-2.2344 4.8086-4.207 6.582z"/>
        <use x="70" y="644" xlink:href="#v"/>
        <use x="90.550781" y="644" xlink:href="#b"/>
        <use x="104.359375" y="644" xlink:href="#a"/>
        <use x="123.347656" y="644" xlink:href="#f"/>
        <use x="142.242188" y="644" xlink:href="#e"/>
        <use x="155.628906" y="644" xlink:href="#a"/>
        <use x="174.617188" y="644" xlink:href="#j"/>
        <use x="204.410156" y="644" xlink:href="#i"/>
        <use x="224.453125" y="644" xlink:href="#d"/>
        <use x="252.453125" y="644" xlink:href="#h"/>
        <use x="274.121094" y="644" xlink:href="#g"/>
        <use x="294.054688" y="644" xlink:href="#d"/>
        <use x="312.304688" y="644" xlink:href="#f"/>
        <use x="340.949219" y="644" xlink:href="#u"/>
        <use x="364.191406" y="644" xlink:href="#a"/>
        <use x="383.179688" y="644" xlink:href="#b"/>
        <use x="396.992188" y="644" xlink:href="#a"/>
        <use x="415.980469" y="644" xlink:href="#t"/>
        <use x="434.234375" y="644" xlink:href="#d"/>
        <use x="452.484375" y="644" xlink:href="#f"/>
        <use x="471.378906" y="644" xlink:href="#g"/>
        <use x="491.3125" y="644" xlink:href="#s"/>
        <use x="509.933594" y="644" xlink:href="#c"/>
        <use x="70" y="672" xlink:href="#r"/>
        <use x="82.183594" y="672" xlink:href="#b"/>
        <use x="95.992188" y="672" xlink:href="#c"/>
        <use x="115.226562" y="672" xlink:href="#q"/>
        <use x="154.152344" y="672" xlink:href="#e"/>
        <use x="167.535156" y="672" xlink:href="#p"/>
        <use x="187.46875" y="672" xlink:href="#a"/>
        <use x="216.207031" y="672" xlink:href="#o"/>
        <use x="239.640625" y="672" xlink:href="#c"/>
        <use x="258.878906" y="672" xlink:href="#n"/>
        <use x="278.8125" y="672" xlink:href="#g"/>
        <use x="308.492188" y="672" xlink:href="#m"/>
        <use x="329.015625" y="672" xlink:href="#b"/>
        <use x="342.820312" y="672" xlink:href="#c"/>
        <use x="362.058594" y="672" xlink:href="#l"/>
        <use x="371.65625" y="672" xlink:href="#a"/>
        <use x="390.648438" y="672" xlink:href="#k"/>
        <use x="407.242188" y="672" xlink:href="#e"/>
      </g>
      </svg>
    </div>

      <p>Bob hasn't accepted the chat yet</p>
    {/if}
    <ChatFeedMessage />
    {#each Object.values(messages) as { content, timeSent, sender, type, id }}
      <ChatBubble message={content} time={timeSent} isClient={sender === user.is.pub } name={sender} id={id} type={type} />
    {/each}
  </div>
  <div>
    <div class='text-box'>
      <form on:submit={sendNewMessage}>
        <input class="text-input" />
        <button type="submit">Send!</button>
      </form>
    </div>
  </div>
</div>

<style>
  .container {
    margin: auto;
    display: flex;
    flex-direction: column;
    height: calc(100vh - 200px);
    background-color: rgba(0, 0, 0, 0.05);
  }
  .chat-window {
    height: 100%;
    overflow-y: auto;
    max-width: 1500px;
  }

  .chat-window--waiting {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
  }

  .text-input {
    width: 100%;
    background: transparent;
    border: none;
    outline: none;
    position: relative;
    margin: 0;
    z-index: 2;
  }

  .image {
    width: 200px;
    height: 200px;
  }

  .image > svg {
    width: 100%;
    height: 100%;
  }

  .text-box {
    margin: 10px 0;
    padding: 20px;
    position: relative;
    display: flex;
    align-items: center;
  }

  .text-box::before {
    content: '';
    display: block;
    border: none;
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 10px;
    z-index: -1;
  } 
</style>